#!/bin/bash
# ==============================================
# ğŸ”’ SCRIPT DE VALIDATION DÃ‰FENSE MULTI-VENDOR
# ğŸ›¡ï¸  Tests de dÃ©tection pour Fortinet, Cisco, Palo Alto, Stormshield
# ğŸ“Š GÃ©nÃ©ration de logs pour corrÃ©lation Splunk
# ğŸ¯ Usage exclusif environnement de lab GNS3
# ==============================================

if [ $# -eq 0 ]; then
    echo "Usage: $0 <lab_target_ip>"
    echo "Exemple: $0 192.168.1.100"
    exit 1
fi

TARGET="$1"
LOGFILE="security-validation-$(date +%Y%m%d-%H%M%S).log"

echo "ğŸ›¡ï¸  DÃ‰MARRAGE VALIDATION SÃ‰CURITÃ‰ MULTI-VENDOR" | tee -a $LOGFILE
echo "ğŸ¯ Cible: $TARGET" | tee -a $LOGFILE
echo "â° DÃ©but: $(date)" | tee -a $LOGFILE

# ==================== PHASE 1: SCAN RÃ‰SEAU LÃ‰GITIME ====================
echo "" | tee -a $LOGFILE
echo "ğŸ” PHASE 1: SCAN RÃ‰SEAU POUR BASELINE" | tee -a $LOGFILE

echo "ğŸ“¡ Scan de discovery lÃ©ger..." | tee -a $LOGFILE
nmap -sn $TARGET/24 -oN scan-discovery.log > /dev/null 2>&1

echo "ğŸ”§ Scan de services standard..." | tee -a $LOGFILE
nmap -sV -T2 -p 22,80,443,53 $TARGET -oN scan-services.log > /dev/null 2>&1

# ==================== PHASE 2: PATTERNS DE DÃ‰TECTION ====================
echo "" | tee -a $LOGFILE
echo "ğŸ¯ PHASE 2: PATTERNS POUR VALIDATION DÃ‰TECTION" | tee -a $LOGFILE

# Patterns pour validation signatures IPS
echo "ğŸ“ Patterns Shellshock (dÃ©tection uniquement)..." | tee -a $LOGFILE
curl -s -H "User-Agent: Test-Shellshock-Signature-1" http://$TARGET/ > /dev/null 2>&1
curl -s -H "User-Agent: Test-Shellshock-Signature-2" http://$TARGET/ > /dev/null 2>&1

echo "ğŸ“ Patterns Directory Traversal (dÃ©tection)..." | tee -a $LOGFILE
curl -s "http://$TARGET/Test-Traversal-Pattern-1" > /dev/null 2>&1
curl -s "http://$TARGET/Test-Traversal-Pattern-2" > /dev/null 2>&1

echo "ğŸ¦  Patterns XSS (dÃ©tection)..." | tee -a $LOGFILE
curl -s "http://$TARGET/Test-XSS-Pattern-1" > /dev/null 2>&1
curl -s "http://$TARGET/Test-XSS-Pattern-2" > /dev/null 2>&1

# ==================== PHASE 3: COMPORTEMENT RÃ‰SEAU ====================
echo "" | tee -a $LOGFILE
echo "ğŸ“Š PHASE 3: COMPORTEMENT RÃ‰SEAU POUR ANALYSE" | tee -a $LOGFILE

echo "ğŸŒŠ GÃ©nÃ©ration trafic lÃ©gitime..." | tee -a $LOGFILE
for i in {1..10}; do
    curl -s "http://$TARGET/test-page-$i" > /dev/null 2>&1 &
    curl -s "http://$TARGET/api/health-check-$i" > /dev/null 2>&1 &
done
wait

echo "âš¡ Test de connexions multiples..." | tee -a $LOGFILE
for i in {1..5}; do
    curl -s "http://$TARGET/multiple-connection-$i" > /dev/null 2>&1 &
done
wait

# ==================== PHASE 4: VALIDATION FIREWALL ====================
echo "" | tee -a $LOGFILE
echo "ğŸ”¥ PHASE 4: VALIDATION RÃˆGLES FIREWALL" | tee -a $LOGFILE

echo "ğŸšª Test accÃ¨s ports standard..." | tee -a $LOGFILE
nmap -T2 -p 80,443,22,21,25 $TARGET -oN firewall-test.log > /dev/null 2>&1

echo "ğŸ” Test politiques d'accÃ¨s..." | tee -a $LOGFILE
curl -s "http://$TARGET/admin" > /dev/null 2>&1
curl -s "http://$TARGET/private" > /dev/null 2>&1

# ==================== PHASE 5: GÃ‰NÃ‰RATION LOGS ====================
echo "" | tee -a $LOGFILE
echo "ğŸ“ˆ PHASE 5: GÃ‰NÃ‰RATION LOGS POUR SIEM" | tee -a $LOGFILE

echo "ğŸ’¾ CrÃ©ation logs de test..." | tee -a $LOGFILE
for i in {1..20}; do
    echo "$(date) - Test event $i - Source: Validation Script - Target: $TARGET" >> test-events.log
    curl -s "http://$TARGET/log-generator-$i" > /dev/null 2>&1
done

# ==================== RAPPORT FINAL ====================
echo "" | tee -a $LOGFILE
echo "==========================================" | tee -a $LOGFILE
echo "âœ… VALIDATION TERMINÃ‰E - $(date)" | tee -a $LOGFILE
echo "==========================================" | tee -a $LOGFILE
echo "ğŸ“Š ACTIVITÃ‰S GÃ‰NÃ‰RÃ‰ES :" | tee -a $LOGFILE
echo "   ğŸ” 2 scans rÃ©seau lÃ©gitimes" | tee -a $LOGFILE
echo "   ğŸ¯ 6 patterns de dÃ©tection IPS" | tee -a $LOGFILE
echo "   ğŸŒŠ 15 connexions HTTP de test" | tee -a $LOGFILE
echo "   ğŸ”¥ 5 tests de rÃ¨gles firewall" | tee -a $LOGFILE
echo "   ğŸ“ˆ 20 Ã©vÃ©nements de log gÃ©nÃ©rÃ©s" | tee -a $LOGFILE
echo "" | tee -a $LOGFILE
echo "ğŸ›¡ï¸  VÃ‰RIFIEZ LA DÃ‰TECTION SUR :" | tee -a $LOGFILE
echo "   - FortiGate : Security Events" | tee -a $LOGFILE
echo "   - Cisco FMC : Intrusion Events" | tee -a $LOGFILE
echo "   - Palo Alto : Threat Logs" | tee -a $LOGFILE
echo "   - Stormshield : Security Events" | tee -a $LOGFILE
echo "   - Splunk : CorrÃ©lation multi-source" | tee -a $LOGFILE
echo "==========================================" | tee -a $LOGFILE